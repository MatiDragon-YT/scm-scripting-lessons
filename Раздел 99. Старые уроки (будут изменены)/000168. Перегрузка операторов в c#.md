Перегрузка операторов в c#||wmysterio|wmysterio|wmysterio@yandex.ru|/||Всем привет! С Вами wmysterio, и в этом уроке мы рассмотрим очередную возможность в c#, как перегрузка операторов. При создании собственного класса, иногда приходится как-то сравнивать экземпляры одного и того же класса. Например: больше объект за другого или меньше. Обычное объявления класса не позволяет выполнять такие проверки. Однако язык имеет возможность задать условия таких проверок. <br /> Стандарный шаблон перегрузки оператора имеет вид:<!--uzcode--><div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><!--uzc-->public static bool operator > ( ТИП_ДАННЫХ имя1, ТИП_ДАННЫХ имя2 &#41; { <br />&nbsp;&nbsp;return ОПЕРАЦИЯ_ПРОВЕРКИ; <br /> }<!--/uzc--></div></div><!--/uzcode-->Перегрузка обязательно должна быть статической(общей)! Операция проверки выполняется как правило с каким-то значением поля или свойства класса, по которым можно сравнить два экземпляра. Одним из параметров в шаблоне должен быть тип, который соответсвует классу, в который вложен метод. Порядок аргументов имеет значение и я продемонструрую это на практике. К примеру, создалим простой класс Car, с набором стандартных свойств:<!--uzcode--><div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><!--uzc-->public class Car { <br /><br />&nbsp;&nbsp;public int Size { get; set; } <br />&nbsp;&nbsp;public string Name { get; set; } <br /><br />&nbsp;&nbsp;public Car(&#41; { <br />&nbsp;&nbsp;Size = 10; <br />&nbsp;&nbsp;Name = "Car"; <br />&nbsp;&nbsp;} <br /> }<!--/uzc--></div></div><!--/uzcode-->Свойства отвечают за размер машины и её имя. Логично было бы сравнивать по размеру машины, а не по её имени для оператора > или <. Из этого наша перегрузка будет иметь вид:<!--uzcode--><div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><!--uzc-->public static bool operator > ( Car car1, Car car2 &#41; { <br />&nbsp;&nbsp;return car1.Size > car2.Size; <br /> }<!--/uzc--></div></div><!--/uzcode-->В качестве параметров мы передали два объекта, класса Car. C# требует, чтобы с этой перегрузкой так же была объявлена и операция для <:<!--uzcode--><div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><!--uzc-->public static bool operator &lt; ( Car car1, Car car2 &#41; { <br />&nbsp;&nbsp;return !( car1 > car2 &#41;; <br /> }<!--/uzc--></div></div><!--/uzcode-->В последнем я делал проверку на БОЛЬШЕ между передаными параметрами, и возвращал инвертированное булевое значение. Полная программа будет иметь код:<!--uzcode--><div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><!--uzc-->namespace TestProgramm { <br /><br />&nbsp;&nbsp;class Program { <br /><br />&nbsp;&nbsp;static void Main( string&#91;] args &#41; { <br /><br />&nbsp;&nbsp;Car c1 = new Car(&#41;; <br />&nbsp;&nbsp;Car c2 = new Car(&#41;; <br />&nbsp;&nbsp;c1.Size = 100; <br />&nbsp;&nbsp;c2.Size = 70; <br /><br />&nbsp;&nbsp;if( c1 > c2 &#41; <br />&nbsp;&nbsp;Console.WriteLine( "Машина 1 больше за машину 2" &#41;; <br />&nbsp;&nbsp;else <br />&nbsp;&nbsp;Console.WriteLine( "Машина 1 не больше за машину 2" &#41;; <br /><br />&nbsp;&nbsp;Console.ReadKey(&#41;; <br />&nbsp;&nbsp;} <br /><br />&nbsp;&nbsp;} <br /><br />&nbsp;&nbsp;public class Car { <br /><br />&nbsp;&nbsp;public int Size { get; set; } <br />&nbsp;&nbsp;public string Name { get; set; } <br /><br />&nbsp;&nbsp;public Car(&#41; { <br />&nbsp;&nbsp;Size = 10; <br />&nbsp;&nbsp;Name = "Car"; <br />&nbsp;&nbsp;} <br /><br />&nbsp;&nbsp;public static bool operator > ( Car car1, Car car2 &#41; { <br />&nbsp;&nbsp;return car1.Size > car2.Size; <br />&nbsp;&nbsp;} <br />&nbsp;&nbsp;public static bool operator &lt; ( Car car1, Car car2 &#41; { <br />&nbsp;&nbsp;return !( car1 > car2 &#41;; <br />&nbsp;&nbsp;} <br /><br />&nbsp;&nbsp;} <br /><br /> }<!--/uzc--></div></div><!--/uzcode-->Если нам нужно вравнить экземпляр класса с другим классом или структурой, то в параметрах мы должны подставить другой тип и сравнивать их по какой-то характеристике. Для примера, мы хотим, чтобы наш объект Car можно было сравнить размер с целым числом. Для этого используем следующие перегрузки:<!--uzcode--><div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><!--uzc-->public static bool operator > ( Car car1, int Value &#41; { <br />&nbsp;&nbsp;return car1.Size > Value; <br /> } <br /> public static bool operator &lt; ( Car car1, int Value &#41; { <br />&nbsp;&nbsp;return car1.Size &lt; Value; <br /> }<!--/uzc--></div></div><!--/uzcode-->Теперь мы сможем сравнивать Car с типом int:<!--uzcode--><div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><!--uzc-->static void Main( string&#91;] args &#41; { <br /><br />&nbsp;&nbsp;Car c1 = new Car(&#41;; <br />&nbsp;&nbsp;Car c2 = new Car(&#41;; <br />&nbsp;&nbsp;c1.Size = 100; <br />&nbsp;&nbsp;c2.Size = 70; <br /><br />&nbsp;&nbsp;if( c1 > 80 &#41; <br />&nbsp;&nbsp;Console.WriteLine( "Машина 1 больше размер 80" &#41;; <br />&nbsp;&nbsp;else <br />&nbsp;&nbsp;Console.WriteLine( "Машина 1 не больше размер 80" &#41;; <br /><br />&nbsp;&nbsp;if( c2 > 80 &#41; <br />&nbsp;&nbsp;Console.WriteLine( "Машина 2 больше размер 80" &#41;; <br />&nbsp;&nbsp;else <br />&nbsp;&nbsp;Console.WriteLine( "Машина 2 не больше размер 80" &#41;; <br /><br />&nbsp;&nbsp;Console.ReadKey(&#41;; <br /> }<!--/uzc--></div></div><!--/uzcode-->Однако, если мы напишем условие<!--uzcode--><div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><!--uzc-->if( 80 > c1 &#41; { /* действия */ }<!--/uzc--></div></div><!--/uzcode-->то компилятор напомнит нам, что операция не может примятся к операднам int и Car. Это связано как раз таки с тем, что порядок имеет значение при перегрузке операторов. А именно первый агрумент функции будет относить всю функцию к группе методов того типа. Для того, чтобы мы могли выполнить написанные операции, нужно перегрузить их следующим образом:<!--uzcode--><div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><!--uzc-->public static bool operator > ( int Value, Car car1 &#41; { <br />&nbsp;&nbsp;return Value > car1.Size; <br /> } <br /> public static bool operator &lt; ( int Value, Car car1 &#41; { <br />&nbsp;&nbsp;return Value &lt; car1.Size; <br /> }<!--/uzc--></div></div><!--/uzcode-->Проверка<!--uzcode--><div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><!--uzc-->static void Main( string&#91;] args &#41; { <br /><br />&nbsp;&nbsp;Car c1 = new Car(&#41;; <br />&nbsp;&nbsp;Car c2 = new Car(&#41;; <br />&nbsp;&nbsp;c1.Size = 100; <br />&nbsp;&nbsp;c2.Size = 70; <br /><br />&nbsp;&nbsp;if( 80 > c1 &#41; <br />&nbsp;&nbsp;Console.WriteLine( "Размер 80 больше за машину 1" &#41;; <br />&nbsp;&nbsp;else <br />&nbsp;&nbsp;Console.WriteLine( "Размер 80 не больше за машину 1" &#41;; <br /><br />&nbsp;&nbsp;if( 80 > c2 &#41; <br />&nbsp;&nbsp;Console.WriteLine( "Размер 80 больше за машину 2" &#41;; <br />&nbsp;&nbsp;else <br />&nbsp;&nbsp;Console.WriteLine( "Размер 80 не больше за машину 2" &#41;; <br /><br />&nbsp;&nbsp;Console.ReadKey(&#41;; <br /> }<!--/uzc--></div></div><!--/uzcode-->показала, что всё адекватно отработало. <br /><br /> Аналогично можно сделать для операторов **>=**, **<=**, **==** и **!=** а так-же для других типов данных. <br /><br /> Кроме этих операторов мы можем написать перегрузку и для привычных нам **+**, **-**, ***** и **/**. Операцию присваивания(**=**) нельзя перегружать, как это я наблюдал с C++. <br /> Это значит, что мы сможем к нашему классу Car выполнить арифметические аперации. Для примера, арифметические операции будут выполняться со свойством Size. Шаблон перегрузки немного другой:<!--uzcode--><div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><!--uzc-->public static ТИП_1 operator + ( ПАРАМЕТР_1, ПАРАМЕТР_2 &#41; { <br />&nbsp;&nbsp;return ОБЪЕКТ_ТИП_1; <br /> }<!--/uzc--></div></div><!--/uzcode-->Суть думаю понятна. Мы обязаны сделать возврат объекта того типа, что указали при перегрузке(ТИП_1). Параметры действуют точно так же, как при перегрузке в предыдущих примерах. <br /> Давайте для примера, сделаем перегрузку всех арифметических операций в классе Car:<!--uzcode--><div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><!--uzc-->public static Car operator + ( Car car1, int Value &#41; { car1.Size += Value; return car1; } <br /> public static Car operator - ( Car car1, int Value &#41; { car1.Size -= Value; return car1; } <br /> public static Car operator * ( Car car1, int Value &#41; { car1.Size *= Value; return car1; } <br /> public static Car operator / ( Car car1, int Value &#41; { car1.Size /= Value; return car1; } <br /> public static Car operator + ( int Value, Car car1 &#41; { car1.Size += Value; return car1; } <br /> public static Car operator - ( int Value, Car car1 &#41; { car1.Size -= Value; return car1; } <br /> public static Car operator * ( int Value, Car car1 &#41; { car1.Size *= Value; return car1; } <br /> public static Car operator / ( int Value, Car car1 &#41; { car1.Size /= Value; return car1; }<!--/uzc--></div></div><!--/uzcode-->Проверим:<!--uzcode--><div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><!--uzc-->static void Main( string&#91;] args &#41; { <br /><br />&nbsp;&nbsp;Car c1 = new Car(&#41;; <br />&nbsp;&nbsp;Console.WriteLine( "Изначальное значение размера машины: {0}", c1.Size &#41;; <br />&nbsp;&nbsp;c1 += 190; <br />&nbsp;&nbsp;Console.WriteLine( "Изменённое значение размера машины: {0}", c1.Size &#41;; <br />&nbsp;&nbsp;c1 *= 10; <br />&nbsp;&nbsp;Console.WriteLine( "Изменённое значение размера машины: {0}", c1.Size &#41;; <br />&nbsp;&nbsp;c1 /= 100; <br />&nbsp;&nbsp;Console.WriteLine( "Изменённое значение размера машины: {0}", c1.Size &#41;; <br />&nbsp;&nbsp;c1 -= 15; <br />&nbsp;&nbsp;Console.WriteLine( "Конечное значение размера машины: {0}", c1.Size &#41;; <br /><br />&nbsp;&nbsp;Console.ReadKey(&#41;; <br /> }<!--/uzc--></div></div><!--/uzcode-->Всё отлично работает! Но не хватает какой-то изюминки! Точно, мы забыли перегрузить операторы, где можно сделать арифметические операции не только над числами, но и над объектами класса Car! Перегрузим их:<!--uzcode--><div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><!--uzc-->public static Car operator + ( Car car1, Car car2 &#41; { car1.Size += car2.Size; return car1; } <br /> public static Car operator - ( Car car1, Car car2 &#41; { car1.Size -= car2.Size; return car1; } <br /> public static Car operator * ( Car car1, Car car2 &#41; { car1.Size *= car2.Size; return car1; } <br /> public static Car operator / ( Car car1, Car car2 &#41; { car1.Size /= car2.Size; return car1; }<!--/uzc--></div></div><!--/uzcode-->Проверим:<!--uzcode--><div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><!--uzc-->static void Main( string&#91;] args &#41; { <br /><br />&nbsp;&nbsp;Car c1 = new Car(&#41;; <br />&nbsp;&nbsp;Car c2 = new Car(&#41;; <br />&nbsp;&nbsp;Console.WriteLine( "Размер машины 1 до суммы: {0}", c1.Size &#41;; <br />&nbsp;&nbsp;c1 += c2; <br />&nbsp;&nbsp;Console.WriteLine( "Размер машины 1 после суммы: {0}", c1.Size &#41;; <br /><br />&nbsp;&nbsp;Console.ReadKey(&#41;; <br /> }<!--/uzc--></div></div><!--/uzcode-->Всё нормально считает!!! <br /><br /> Важно! Здесь очень важно продумать все перегрузки. <br /><br /> Наш финальный вариант класса Car:<!--uzcode--><div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><!--uzc-->public class Car { <br /><br />&nbsp;&nbsp;public int Size { get; set; } <br />&nbsp;&nbsp;public string Name { get; set; } <br /><br />&nbsp;&nbsp;public Car(&#41; { <br />&nbsp;&nbsp;Size = 10; <br />&nbsp;&nbsp;Name = "Car"; <br />&nbsp;&nbsp;} <br /><br />&nbsp;&nbsp;public static bool operator > ( Car car1, Car car2 &#41; { return car1.Size > car2.Size; } <br />&nbsp;&nbsp;public static bool operator &lt; ( Car car1, Car car2 &#41; { return !( car1 > car2 &#41;; }&nbsp;&nbsp;<br />&nbsp;&nbsp;public static bool operator > ( Car car1, int Value &#41; { return car1.Size > Value; } <br />&nbsp;&nbsp;public static bool operator &lt; ( Car car1, int Value &#41; { return car1.Size &lt; Value; } <br />&nbsp;&nbsp;public static bool operator > ( int Value, Car car1 &#41; { return Value > car1.Size; } <br />&nbsp;&nbsp;public static bool operator &lt; ( int Value, Car car1 &#41; { return Value &lt; car1.Size; } <br /><br />&nbsp;&nbsp;public static Car operator + ( Car car1, int Value &#41; { car1.Size += Value; return car1; } <br />&nbsp;&nbsp;public static Car operator - ( Car car1, int Value &#41; { car1.Size -= Value; return car1; } <br />&nbsp;&nbsp;public static Car operator * ( Car car1, int Value &#41; { car1.Size *= Value; return car1; } <br />&nbsp;&nbsp;public static Car operator / ( Car car1, int Value &#41; { car1.Size /= Value; return car1; } <br />&nbsp;&nbsp;public static Car operator + ( int Value, Car car1 &#41; { car1.Size += Value; return car1; } <br />&nbsp;&nbsp;public static Car operator - ( int Value, Car car1 &#41; { car1.Size -= Value; return car1; } <br />&nbsp;&nbsp;public static Car operator * ( int Value, Car car1 &#41; { car1.Size *= Value; return car1; } <br />&nbsp;&nbsp;public static Car operator / ( int Value, Car car1 &#41; { car1.Size /= Value; return car1; } <br />&nbsp;&nbsp;public static Car operator + ( Car car1, Car car2 &#41; { car1.Size += car2.Size; return car1; } <br />&nbsp;&nbsp;public static Car operator - ( Car car1, Car car2 &#41; { car1.Size -= car2.Size; return car1; } <br />&nbsp;&nbsp;public static Car operator * ( Car car1, Car car2 &#41; { car1.Size *= car2.Size; return car1; } <br />&nbsp;&nbsp;public static Car operator / ( Car car1, Car car2 &#41; { car1.Size /= car2.Size; return car1; } <br /><br /> }<!--/uzc--></div></div><!--/uzcode-->Надеюсь эта информация была полезна для Вас. С Вами wmysterio, увидимся.|1532|1|0||peregruzka_operatorov_v_c|1423317585