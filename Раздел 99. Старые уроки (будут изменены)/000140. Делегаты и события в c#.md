Делегаты и события в c#||wmysterio|wmysterio|wmysterio@yandex.ru|||Всем хай! Прошло очень много времени прежде, чем я понял как работают события и как их вызывать. <br><br>Пришло время передать мой опыт вам! Начнём с ознакомлением нового слова - **<font color="#0000ff">delegate</font>**. Делегат - это объект, который может ссылаться на метод. Его также можно назвать "прототипом метода". Объявляется он как обычный метод, только с приставкой изучаемого нами слова:<table style="width: 100%; border-collapse: collapse;"><tbody><tr><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">СПЕЦИФИКАТОР delegate <font color="#0000ff">ТИП</font> <font color="#808000">ИМЯ</font> ( <font color="#ff0000">СПИСОК_ПАРАМЕТРОВ</font> );<br></td></tr></tbody></table>Так, как делегат - это прототип метода, то он содержит:<br>- <font color="#0000ff">тип возвращаемого значения</font>. Обычно его ставят на void, делая из метода процедуру.<br>- <font color="#808000">имя</font> процедуры или метода<br>- <font color="#ff0000">список параметров</font>, которые передаются в метод. Если их нет, то оставляют пустые скобки.<br><br>Делегат можно объявлять как в пространстве имён, так и внутри класса. В качестве примера создадим делегат внутри класса Car, с которым мы игрались в предыдущих уроках:<table style="width: 100%; border-collapse: collapse;"><tbody><tr><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">public delegate void CarEvent();<br></td></tr></tbody></table>Я назвал более понятным языком, что бы вам было легче понять. Наш делегат называется "Событие автомобиля". Мы не указываем какое именно, а только общее для всех. В нём не будет параметров. Событие - это реакция на какое-то действие с объектом. Чтобы объявить событие, достаточно написать следующий код:<table style="width: 100%; border-collapse: collapse;"><tbody><tr><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">public **event** <font color="#0000ff">CarEvent</font> <font color="#808000">Wrecked</font>;<br></td></tr></tbody></table>Мы указали видимость этого события, казали ключевое слово **event** и <font color="#0000ff">прототип</font> метода(наш делегат) и <font color="#808000">имя</font> события. Наш класс теперь такой:<table style="width: 100%; border-collapse: collapse;"><tbody><tr><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">&nbsp;&nbsp;&nbsp; public class Car {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public delegate void CarEvent();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public event CarEvent Wrecked;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Car() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Name = "Автомобиль";<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string Name { get; set; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int CurrentSpeed { get; set; }<br>&nbsp;&nbsp;&nbsp; }<br></td></tr></tbody></table>Теперь объект класса получил событие(события обозначаются значком молнии):<br><!--IMG1--><img alt="" src="/_pu/1/53890969.png" /><!--IMG1--><br>Но это только видимость того, что у объекта есть событие. Нам нужно указать когда именно будет срабатывать это событие. Раз я назвал событие Wrecked, то есть повреждён, то есть смысл создать свойство Health, которое на которое будет реагировать событие:<table style="width: 100%; border-collapse: collapse;"><tbody><tr><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private int _health;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int Health {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return _health;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _health = value;<br><font color="#006400">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( 1 &gt; _health &amp;&amp; Wrecked != null )<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wrecked();</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br></td></tr></tbody></table>Думаю, вы обратили внимание на блок <font color="#0000ff">set</font>, а именно на проверку. Расскажу для чего она нужно. Чтобы событие отвечало действительности, нам нужно проверить, что бы жизнь транспорта был меньше нуля а также проверить на то, что событие существует и не вызвано. Теперь изюминка: откуда взялся метод <font color="#800080">Wrecked()</font>? Я бы назвал его гибридом, так как имя метода формируется из события, а параметры - из делегата, причём параметр делегата называют аргументом, а все аргументы - сигнатурой. Вызывая этот метод мы сообщаем о том, что событие произошло.<br><br>Теперь наш класс имеет такой вид:<table style="width: 100%; border-collapse: collapse;"><tbody><tr><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">&nbsp;&nbsp;&nbsp; public class Car {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public delegate void CarEvent();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public event CarEvent Wrecked;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Car() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Name = "Автомобиль";<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Health = 100;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string Name { get; set; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int CurrentSpeed { get; set; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private int _health;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int Health {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return _health;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _health = value;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( 1 &gt; _health &amp;&amp; Wrecked != null )<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wrecked();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br></td></tr></tbody></table>Теперь если указать значение жизни транспорта ниже 1 произойдёт событие Wrecked. Наша задача выполнена - мы <u>написали своё событие в c# без использования стандартных конструкций</u>.<br><br>Мы можем подписаться и отписываться на события. Для этого служат следующие выражения:<table style="width: 100%; border-collapse: collapse;"><tbody><tr><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">+=<br></td><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">Оформить подписку на событие<br></td></tr><tr><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">-=<br></td><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">Отписаться от события<br></td></tr></tbody></table>Вот пример подписки на события:<table style="width: 100%; border-collapse: collapse;"><tbody><tr><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">Car MyCar = new Gallardo();<br>MyCar.Wrecked += new Car.CarEvent( MyCar_Wrecked );<br></td></tr></tbody></table>Для каждой подписки указывается делегат и, если он внутри класса, класс. В скобках указывается имя функции, которая будет обрабатывать события. В нашем случаи обработчик будет иметь следующий вид:<table style="width: 100%; border-collapse: collapse;"><tbody><tr><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; static void MyCar_Wrecked() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Транспорт уничтожен!");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br></td></tr></tbody></table>Не знаю как в других версиях Visual Studio(я использую 2010-ю), но при написании += компилятор автоматически предлагает написать обработчик и делегат:<br><!--IMG2--><a href="/_pu/1/36227451.png" class="ulightbox" target="_blank" title="Нажмите, для просмотра в полном размере..."><img alt="" src="/_pu/1/s36227451.jpg" /></a><!--IMG2--><br>Нажимаем 2 раза TAB, и делегат с обработчиком автоматически вставятся к поле кода. Достаточно удобная возможность, не так ли?<br><br>Так, подписка оформлена, обработчик написан. Осталось только проверить работает ли наше событие. для этого воспользуемся циклом for чтобы имитировать состояние жизни транспорта:<table style="width: 100%; border-collapse: collapse;"><tbody><tr><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for ( int i = 50; i &gt; -5; i-- ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Жизнь транспорта: {0}", i);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyCar.Health = i;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br></td></tr></tbody></table>Результат:<br><!--IMG3--><img alt="" src="/_pu/1/02431911.png" /><!--IMG3--><br>Вывод: всякий раз, когда мы задаём жизнь транспорта меньше единицы срабатывает событие и сообщает в консоль, что транспорт уничтожен.<br><br>Помню, <font color="#0000ff">Vital</font> в своих видео-уроках по c# спрашивал как сделать так, что бы событие срабатывало только один раз. Отвечаю на этот вопрос. Чтобы событие больше не срабатывало, нужно использовать выражение -= вместо +=. В этом примере это будет так:<br><table style="width: 100%; border-collapse: collapse;"><tbody><tr><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">MyCar.Wrecked <font color="#0000ff">-=</font> new Car.CarEvent( MyCar_Wrecked );<br></td></tr></tbody></table>Полностью идентичен записи подписки, только со знаком <font color="#0000ff">-</font>. Когда использовать это выражение? Давайте напишем код так, чтобы обработчик сообщил только 1 раз, что транспорт уничтожен. так как поля и методы у "главного класса" статические, то объявим переменную <font color="#0000ff">DisableEvent</font> типа bool, которая будет сообщать когда отписаться от события:<table style="width: 100%; border-collapse: collapse;"><tbody><tr><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">&nbsp;&nbsp;&nbsp; class Program {<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; static bool DisableEvent = false;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; static void Main() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Car MyCar = new Gallardo();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyCar.Wrecked += new Car.CarEvent( MyCar_Wrecked );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for ( int i = 50; i &gt; -5; i-- ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Жизнь транспорта: {0}", i);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyCar.Health = i;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( DisableEvent )<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyCar.Wrecked -= new Car.CarEvent( MyCar_Wrecked );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.ReadKey();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static void MyCar_Wrecked() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Транспорт уничтожен!");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DisableEvent = true;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br></td></tr></tbody></table>Результат:<br><!--IMG4--><img alt="" src="/_pu/1/02856878.png" /><!--IMG4--> <br><br>Во многих случаях при использовании уже готовых событий у обработчика бывают какие-то "непонятные выражения" типа<table style="width: 100%; border-collapse: collapse;"><tbody><tr><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">object sender, EventArgs e<br></td></tr></tbody></table>Объясню что это такое и откуда оно берётся:<br><font color="#0000ff">object sender </font>- это объект класса который передал событие.<br><font color="#0000ff">EventArgs e</font> - аргументы, которые были указаны в делегате; указывается класс конструктор которого является делегатом. Возвращает публичные поля этого класса. Принято аргументы называть буквой <font color="#0000ff">e</font>, (от event)<br><br>Давайте модифицируем делегат с этого примера:<table style="width: 100%; border-collapse: collapse;"><tbody><tr><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">public delegate void CarEvent( object sender, int e);<br></td></tr></tbody></table>Также нам нужно отредактировать вызов события под эту сигнатуру:<table style="width: 100%; border-collapse: collapse;"><tbody><tr><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">if ( 1 &gt; _health &amp;&amp; Wrecked != null )<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wrecked(this, _health);<br></td></tr></tbody></table><font color="#0000ff">this</font> - указываем объект, который передаёт событие, в нашим случаи передастся <font color="#0000ff">Car</font>.<br>В качестве аргумента <font color="#0000ff">e</font> передаём поле класса - <font color="#0000ff">_health</font>. Теперь переработаем обработчик под сигнатуру:<table style="width: 100%; border-collapse: collapse;"><tbody><tr><td style="vertical-align: top; border-width: 1px; border-style: solid; border-color: #000000; letter-spacing: 0px; word-spacing: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static void MyCar_Wrecked( object sender, int e ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Транспорт уничтожен!");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DisableEvent = true;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br></td></tr></tbody></table>Теперь поле _health будет передано через аргумент e, хоть и само поле не будет доступно через класс.<br><br>Исходный код:<!--uzcode--><div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><!--uzc-->using System;<br><br>namespace Consol {<br>&nbsp;&nbsp;&nbsp; class Program {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; static bool DisableEvent = false;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; static void Main() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Car MyCar = new Gallardo();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyCar.Wrecked += new Car.CarEvent( MyCar_Wrecked );<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for ( int i = 50; i &gt; -5; i-- ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Жизнь транспорта: {0}", i);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyCar.Health = i;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( DisableEvent )<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyCar.Wrecked -= new Car.CarEvent( MyCar_Wrecked );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.ReadKey();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static void MyCar_Wrecked( object sender, int e ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Транспорт уничтожен! {0}", (e + 55).ToString());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DisableEvent = true;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; public class Car {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public delegate void CarEvent( object sender, int e);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public event CarEvent Wrecked;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Car() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Name = "Автомобиль";<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Health = 100;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string Name { get; set; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int CurrentSpeed { get; set; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private int _health;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int Health {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return _health;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _health = value;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( 1 &gt; _health &amp;&amp; Wrecked != null )<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wrecked(this, _health);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; public class Lanborghini : Car {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int DoorCount = 4;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string EngineType = "Automatic";<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Lanborghini() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Name = "Ламборгини";<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; public class Porshe : Car {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int DoorCount = 2;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string EngineType = "Automatic";<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int WheelsSize = 5;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Porshe() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Name = "Порше";<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; public class Gallardo : Lanborghini {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int EnginePower = 1500;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int TireSize = 4;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Gallardo() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Name = "Галлардо";<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br><br>}<!--/uzc--></div></div><!--/uzcode--><br>"Вот такие у нас пироги" <img src="http://s49.ucoz.net/sm/15/smile.gif" alt="smile" align="absmiddle" border="0"> С вами был wmysterio.|1401|1|0|53890969`png`172`171\|36227451`png`563`54`400`38\|02431911`png`168`159\|02856878`png`181`134\||delegaty_i_sobytija_v_c|1392798603