Запуск другой формы из основной, ListBox, MenuStrip||wmysterio|wmysterio|wmysterio@yandex.ru|/||Всем осветительный привет! Мы продолжаем изучать формы Windows и сегодня мы будем учится запускать новую форму из окна основной, а также рассмотрим такие элементы, как ListBox и MenuStrip. <br><br>Начнём с того, что будем создавать обычное меню, которое можно наблюдать в стандартных окнах. Для этого найдите компонент MenuStrip и переместите его в макет программы:<br><!--IMG1--><a href="/_pu/2/81769077.png" class="ulightbox" target="_blank" title="Нажмите, для просмотра в полном размере..."><img alt="" src="/_pu/2/s81769077.jpg" /></a><!--IMG1--><br>По-умолчанию меню выводится сверху, как видно на рисунке выше. Это визуальный редактор меню. В поле "Вводить здесь" нам предлагают ввести имя ячейки каждого пункта нашей навигации. При нажатии на элемент в нас выскакивают дополнительные места для будущих команд:<br><!--IMG2--><img alt="" src="/_pu/2/74422300.png" /><!--IMG2--><br>Соответственно всё, что будет написано справа будет горизонтальной навигацией, а что внизу - подпункты выделенной категории. Для начала создадим 3 пункта меню: "**Файл**", "**Команды**" и "**Справка**". В меню файл создадим 2 пункта: "**Сохранить HTML**" и "**Выход**":<br><!--IMG3--><img alt="" src="/_pu/2/96864589.png" /><!--IMG3--><br>В меню "Команды" добавим только 1 пункт - "**История**", а в Справку закинем "**Об авторе**" и "**О программе**".<br><br>Наше меню готово, осталось только написать логику этих пунктов. Но прежде всего предлагаю сместить объект кнопка, браузер и ТекстБокс на небольшое расстояние от панели меню. Если это сделать, то получится эффект, когда меню частично закрывает кнопку и поле ввода, что намекает на криворукость программиста <img src="http://s49.ucoz.net/sm/15/smile.gif" alt="smile" align="absmiddle" border="0"> Думаю при компиляции без изменений сразу будет видим этот эффект. Ваша задача - подкорректировать элементы макета под более удобный вид.&nbsp; <br><br>В этом уроке мы рассмотрим выполнение 2-х функций - "Выход" и "История". Знаю, что выйти с программы можно и нажав красный крестик, но я предлагаю сделать это программно, вдруг кому-то пригодится <img src="http://s49.ucoz.net/sm/15/smile.gif" alt="smile" align="absmiddle" border="0"> Мы должны сделать обработчик события "Клик" по пункту меню. Два раза нажимаем ЛКМ по нужной ячейке меню, чтобы компилятор автоматически создал подписку и обработчик события:<br><!--IMG4--><img alt="" src="/_pu/2/53095560.png" /><!--IMG4--><br>и в обработчике пишем всего одну команду:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><font color="#0000cd">private void выходToolStripMenuItem_Click( object sender, EventArgs e ) {</font><br>&nbsp;&nbsp;&nbsp;&nbsp; <font color="#006400">Application.Exit();</font><br><font color="#0000cd">}</font></div></div> С историей посещённый сайтов немного сложнее. Здесь есть куда разный вариантов. Я предлагаю немного усовершенствовать библиотеку, которую мы создали в предыдущем уроке.<br><br>Заходим в проект BrowserLib и нажимаем комбинацию <font color="#0000cd">CTRL</font>+<font color="#0000cd">SHIFT</font>+<font color="#0000cd">A</font>, и добавляем новую форму, назвав её, например, History:<br><!--IMG5--><a href="/_pu/2/75561017.png" class="ulightbox" target="_blank" title="Нажмите, для просмотра в полном размере..."><img alt="" src="/_pu/2/s75561017.jpg" /></a><!--IMG5--><br>Теперь мы можем визуализировать нашу новую форму. Предлагаю эту форму сделать фиксированной, размером 400х350, режим авто-размера: **GrowAndShrink**. Добавим туда новый компонент - **ListBox** и разместим его на форме. Добавим ещё 2 кнопки: "<u>удалить запись</u>", "<u>очистить</u>". Если пользователь нажмёт 2 раза ЛКМ по элементу списка, то браузер перейдёт по сохранённой ссылке. Кроме этого создадим лейбл, который будет иметь имя "Нет". Этот компонент будет отображать дату записи, которую мы указали в момент добавления записи лога. В итоге мы должны получить такое окно:<br><!--IMG6--><a href="/_pu/2/29877193.png" class="ulightbox" target="_blank" title="Нажмите, для просмотра в полном размере..."><img alt="" src="/_pu/2/s29877193.jpg" /></a><!--IMG6--><br>**ListBox** сам-по-себе не очень сложный в освоении, и очень поход на обычные списки, только в визуальном оформлении. Прежде всего нужно заполнить список информацией. По-задумке, в форму будет передан некий массив строк с которых будет формироваться список. Перейдём в режим редактирования(клавиша F7). В конструктор впишем аргумент - string[] LINKS. Чтобы мы могли выводить дату, мы должны хранить её где-нить, по-этому предлагаю добавить **private** поле со списком:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');">private List&lt;string&gt; DATE = new List&lt;string&gt;();<font color="#0000cd"></font></div></div> Так, как одна из функций данного окна является переход по ссылке, мы должны вернуть эту ссылку в виде строки. Пишем:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');">public string retLink = "";</div></div> Дальше уже идёт процесс заполнения. После процедуры **InitializeComponent()** добавим следующий код:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><font color="#0000cd">public History( string[] LINKS ) {<br>&nbsp;&nbsp;&nbsp; InitializeComponent();</font><br><br><font color="#006400">&nbsp;&nbsp;&nbsp; if ( LINKS == null ) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; button1.Enabled = false;<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; button2.Enabled = false;<br>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; return;<br>&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp; foreach ( string Temp in LINKS ) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; string[] s = Temp.Split( '\|' );<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; DATE.Add(s[0]);<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; listBox1.Items.Add(s[1]);<br>&nbsp;&nbsp;&nbsp; }</font><br><font color="#0000cd">}</font></div></div> Рассмотрим первый блок. По логике, если нам передали пустой или несуществующий массив, то значит никаких ссылок в логе у нас нет. По этому все действия будут бесполезны, по этому зададим активность наших кнопок в режим "спячки" и сражу же выходим с конструктора с помощи **return**. Если массив всё-таки существует и имеет записи, то условие не выполняется и идёт второй блок. Мы в цикле обходим все строки в массиве. Каждую строчку мы разделяем сепаратором <font color="#006400">Split( '\|' )</font>. Суть этого метода в том, что он берёт каждую подстроку и записывает в массив, каждая строка является новым элементом. То есть если у нас есть строка "111\|222\|333\|444\|555", то на выходе мы получим массив с элементами:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');">Arrey<br>[0]111<br>[1]222<br>[2]333<br>[3]444<br>[4]555<font color="#0000cd"></font></div></div> Символ <font color="#006400">'\|'</font> является сепаратором и в массив не входит. Так как наша строка имеет всего один символ сепаратора, то на выходе мы получим массив с 2-х элементов: даты и ссылки. Нулевой элемент мы запишем в список DATE, а первый в ListBox.<br><br>Процесс заполнения окончен.Дальше уже идёт реализация. Создадим обработчик события для кнопки "Удалить запись". Прежде всего нам необходимо узнать текущий выбранный элемент:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');">listBox1.SelectedIndex</div></div> А потом его удалить командой:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');">listBox1.Items.RemoveAt( INDEX );</div></div> Так, как мы должны удалить и в списке дат элемент, то более оптимально будет вынести индекс в переменную, чтобы не делать лишних запросов:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');">int Index = listBox1.SelectedIndex;<br>listBox1.Items.RemoveAt( Index );<br>DATE.RemoveAt( Index );<br>listBox1.SelectedIndex = 0;</div></div> Однако есть исключение - нельзя отнимать несуществующие элементы, по этому мы должны поставить условия, что если к-во элементов списка больше нуля, то удалять, иначе отключим кнопки:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><font color="#0000cd">private void button2_Click( object sender, EventArgs e ) {</font><br><font color="#006400">&nbsp;&nbsp;&nbsp; if ( listBox1.Items.Count &gt; 0 ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int Index = listBox1.SelectedIndex;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; listBox1.Items.RemoveAt( Index );<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DATE.RemoveAt(Index);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( 1 &gt; listBox1.Items.Count ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; button1.Enabled = false;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; button2.Enabled = false;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; } else {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; button1.Enabled = false;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; button2.Enabled = false;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; }</font><br><font color="#0000cd">}</font></div></div> Процесс очистки всех элементов ещё проще. Можно конечно было бы делать циклы и тому подобное, но Майкрософт уже сделали это за нас, создав отличный метод очистки:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><font color="#0000cd">private void button1_Click( object sender, EventArgs e ) {</font><br><font color="#006400">&nbsp;&nbsp;&nbsp; listBox1.Items.Clear();<br>&nbsp;&nbsp;&nbsp; DATE.Clear();<br>&nbsp;&nbsp;&nbsp; button1.Enabled = false;<br>&nbsp;&nbsp;&nbsp; button2.Enabled = false;</font>&nbsp; <br><font color="#0000cd">}</font><font color="#0000cd"></font></div></div> Итак, мы научили список удалятся 2-мя способами: по одному и всё вместе. Он умеет получать данные из вне. Теперь разберёмся с датами. Здесь проще простого. Выбираем наш список в макете программы и ищем событие SelectedIndexChanged, жмём 2 раза на поле и получаем обработчик события:<br><!--IMG7--><a href="/_pu/2/10715290.png" class="ulightbox" target="_blank" title="Нажмите, для просмотра в полном размере..."><img alt="" src="/_pu/2/s10715290.jpg" /></a><!--IMG7--><br>Этот блок рекомендую брать в блок try, так как индекс после удаления очищается.<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><font color="#0000cd">private void listBox1_SelectedIndexChanged( object sender, EventArgs e ) {</font><br><font color="#006400">&nbsp;&nbsp;&nbsp; try {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; label1.Text = DATE[ listBox1.SelectedIndex ].ToString();<br>&nbsp;&nbsp;&nbsp; } catch {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; label1.Text = "НЕТ";<br>&nbsp;&nbsp;&nbsp; }</font><br><font color="#0000cd">}</font><font color="#0000cd"></font></div></div> Итак, у нас теперь теперь осталась одна задача - переход на ссылке по двойному клику в списке. Здесь тоже нет ничего сложного - наша форма этого делать не будет, это осуществит dll-библиотека, а мы должны только передадим нужное значение. Опять переходим в события ЛистБокса и выбираем событие "**DoubleClick**". В обработчике пишем следующий текст:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><font color="#0000cd">private void listBox1_DoubleClick( object sender, EventArgs e ) {</font><br><font color="#006400">&nbsp;&nbsp;&nbsp; retLink = listBox1.Items[ listBox1.SelectedIndex ].ToString();<br>&nbsp;&nbsp;&nbsp; Close();</font><br><font color="#0000cd">}</font><font color="#0000cd"></font></div></div> Суть в том, что мы передаём через публичную переменную ссылку а затем просто закрываем форму, используя процедуру **Close()**.<br><br>Казалось весь функционал формы уже сделан, но есть один интересный факт: удаляли мы только со списка, но не с файла. Нам нужно осуществить перезапись файла. Это делается не очень сложно. Для начала зайдём в события самой формы и выбираем "**FormClosing**". Это событие возникает перед самим закрытием формы, а не после, дающий возможности воспользоваться данными формы:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><font color="#0000cd">private void History_FormClosing( object sender, FormClosingEventArgs e ) {</font><br><font color="#006400">&nbsp;&nbsp;&nbsp; string text = "";<br>&nbsp;&nbsp;&nbsp; int j = DATE.Count;<br>&nbsp;&nbsp;&nbsp; if ( j &gt; 0 ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for ( int i = 0; i &lt; j; i++ ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; text += DATE[ i ].ToString() + "\|" + listBox1.Items[ i ].ToString() + "&#92;r&#92;n";<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; File.WriteAllText( "log.txt", text );</font><br><font color="#0000cd">}</font><font color="#0000cd"></font></div></div> Если к-во элементов списка больше нуля, то идёт цикл, который прибавляет строку с нужным форматом к переменной **text**. Дальше идёт переход к записи файла. Если есть записи, то запишутся все. Если нет, то файл будет только пустым.<br><br>На этом мы завершаем проектировать форму и переходим к dll-ке. Добавим новый статический метод:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><font color="#0000cd">public static string DysplayHistory() {</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#006400">// Здесь будет код</font><br><font color="#0000cd">}</font><font color="#0000cd"></font></div></div> Чтобы открыть новую форму, нам понадобится подключить библиотеку:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');">using System.Windows.Forms;<font color="#0000cd"></font></div></div> Дальше нужно объявить переменную - нашу форму. Делается это так:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');">НАЗВАНИЕ_ФОРМЫ переменная = new НАЗВАНИЕ_ФОРМЫ(атрибуты);<font color="#0000cd"></font></div><font color="#0000cd"></font></div></div> Так как форму я завал **History**, то конструктор будет следующим:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');">History frm = new History( GetMessages() );<font color="#0000cd"></font></div></div> В качестве параметра я передаю массив строк, который получаю ранее записанным методом <u>**GetMessages**</u>. Дальше нам нужно вызвать форму на экран. Есть 2 способа:<br>1) Вызов модального окна - форма будет поверх всех окон, а остальные будут недоступны(напоминает MessageBox).<br>2) Обычный вызов окна - будет создано окно, но мы может осуществлять и другие действия в проекте, вне создаваемой формы.<br>Я предпочитаю модальный способ:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');">frm.ShowDialog();</div></div> Для обычного:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');">frm.Show();</div></div> Итак, окно открылось, пользователь сделал какие-то действия и закрыл его. Наша процедура возвращает строку, но какую? Так как в окне истории мы предполагали, что пользователь может нажать дабл-клик по списку, то будет переход на тот сайт. Так вот эту стоку метод будет возвращать. Весь метод будет выглядеть так:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><font color="#0000cd">public static string DysplayHistory() {</font><br><font color="#006400">&nbsp;&nbsp;&nbsp; History frm = new History( GetMessages() );<br>&nbsp;&nbsp;&nbsp; frm.ShowDialog();<br>&nbsp;&nbsp;&nbsp; return frm.retLink;</font><br><font color="#0000cd">}</font></div></div> Мы крутые! Форма и библиотека полностью функциональна! Теперь нам остался последний штрих! вызвать эту процедуру с главного окна программы. Для этого дважды кликнем на шаблон ячейки меню "История" и добавим следующий код:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><font color="#000080">private void историяToolStripMenuItem_Click( object sender, EventArgs e ) {</font><br>&nbsp;<font color="#006400">&nbsp;&nbsp; string a = BrowserLog.DysplayHistory();</font><br><font color="#0000cd">}</font></div></div> Делаем тест:<br><!--IMG8--><a href="/_pu/2/42902911.png" class="ulightbox" target="_blank" title="Нажмите, для просмотра в полном размере..."><img alt="" src="/_pu/2/s42902911.jpg" /></a><!--IMG8--><br>Наша задача выполнена. наш браузер научился хранить историю! :)<br><br>Теперь сделаем одну махинацию, чтобы легче и экономнее было использовать наш браузер, а именно создать процедуру, которая будет принимать 1 строковый параметр а сама выполнять переход в браузер:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><font color="#006400">public void FollowLink( string URL ) {<br>&nbsp;&nbsp;&nbsp; try {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; webBrowser1.Url = new Uri( URL );<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; BrowserLog.AddMessage( URL );<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; label1.Text = "";<br>&nbsp;&nbsp;&nbsp; } catch {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; label1.Text = "Неверное имя ссылки!";<br>&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>}</font><font color="#0000cd"></font></div></div> И использовать эту функцию в обработчике кнопки:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><font color="#006400">private void button1_Click( object sender, EventArgs e ) {<br>&nbsp;&nbsp;&nbsp;&nbsp; FollowLink( textBox1.Text );&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>}</font><font color="#0000cd"></font></div></div> Теперь мы можем воспользоваться этой процедурой и в обработчике кнопки меню "**История**":<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><font color="#0000cd">private void историяToolStripMenuItem_Click( object sender, EventArgs e ) {</font><br><font color="#006400">&nbsp;&nbsp;&nbsp;&nbsp; string a = BrowserLog.DysplayHistory();<br>&nbsp;&nbsp;&nbsp;&nbsp; if ( a.Length &gt; 0 ) {<br>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; FollowLink( a );<br>&nbsp;&nbsp;&nbsp;&nbsp; }</font><br><font color="#0000cd">}</font><font color="#0000cd"></font></div></div> Таким образом мы осуществили такое действие: пользователь дважды нажал на ссылку в списке и осуществился переход на эту ссылку.<br><br>Ну и чтобы Вас окончательно утомить, давайте осуществим просьбу одного пользователя - чтобы префикс "http://" автоматически приклеивался, а то постоянно вводить адрес как-то непривычно и не функционально. Реализовать такое просто.Достаточно написать условие:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');">if ( str.ToLower().IndexOf( "http://" ) == -1 ) {<br><font color="#006400">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#006400">str = "http://" + </font><font color="#006400">str;</font><br>}<font color="#0000cd"></font></div></div> а метод FollowLink будет иметь вид:<br> <div class="bbCodeBlock"><div class="bbCodeName" style="padding-left:5px;font-weight:bold;font-size:7pt">Код</div><div class="codeMessage" style="border:1px inset;max-height:200px;overflow:auto;height:expression(this.scrollHeight<5?this.style.height:scrollHeight>200?'200px':''+(this.scrollHeight+5)+'px');"><font color="#0000cd">public void FollowLink( string URL ) {</font><br><font color="#006400">&nbsp;&nbsp;&nbsp;&nbsp; try {<br>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; if ( URL.ToLower().IndexOf( "http://" ) == -1 ) {<br>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; URL = "http://" + URL;<br>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; webBrowser1.Url = new Uri( URL );<br>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; BrowserLog.AddMessage( URL );<br>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; label1.Text = "";<br>&nbsp;&nbsp;&nbsp;&nbsp; } catch {<br>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; label1.Text = "Неверное имя ссылки!";<br>&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br><font color="#0000cd">}</font><font color="#0000cd"></font></div></div> Суть условия проста. Ищем в строке подстроку <font color="#006400"> "http://"</font>. Если такая не нашлась(результат вернул <font color="#ff0000">-1</font>), то просто дописываем эту приставку к строке. Чтобы поиск был корректным, нужно перевести строку в нижний регистр, чем мы воспользовались: <font color="#006400">ToLower()</font>.<br><br>Итак, из этого урока вы извлекли:<br>- Вызов формы из другой формы;<br>- Применили основные команды ListBox и также List;<br>- Научились передавать данные между формой и библиотекой(этот вариант катит и при обмене с другими формами, классами и.т.п.);<br>- Узнали некоторые методы работы со строками Split, ToLower, IndexOf;<br>- Узнали о понятии меню и как писать команды при нажатия кнопки;<br><br>На этом, окончательно, урок окончен. Спасибо за внимание ;)<br>|3469|1|0|81769077`png`581`160`400`110\|74422300`png`235`96\|96864589`png`180`93\|53095560`png`320`168\|75561017`png`587`189`400`128\|29877193`png`416`367`400`352\|10715290`png`561`356`400`253\|42902911`png`600`450`400`300\||zapusk_drugoj_formy_iz_osnovnoj_listbox_menustrip|1399455340