Пример полноценной миссии &quot;Ограбление&quot;||wmysterio|wmysterio|wmysterio@yandex.ru|||Всем привет! Мы продолжаем писать полноценные миссии, и сегодня будем писать скрипт ограбления. Заодно и познакомимся с магнитами поближе, так как ограбления будут на вертолёте! Допустим, что Торино понадобилась помощь CJ в одной операции. Согласно ней, CJ должен украсть 3 патриота, которые стоят в троих разных посёлках.<br><br>Начнём, конечно, со стартера, который поменяет только координаты названия миссии с предыдущего примера полноценной миссии:<table style="border-collapse: collapse; width: 100%; border: 1px solid black;" width=""><tbody><tr><td style="border: 1px solid black;">{$CLEO}<br>thread 'STARTER'<br><br>while true<br>wait 0<br>&nbsp;&nbsp;&nbsp; if<br>&nbsp;&nbsp;&nbsp; $ONMISSION == 0<br>&nbsp;&nbsp;&nbsp; then<br>&nbsp;&nbsp;&nbsp; 03A1: show_sphere_at 401.501 2539.6433 16.5452 radius 2.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00EC:&nbsp;&nbsp; actor $PLAYER_ACTOR sphere 0 near_point 401.501 2539.6433 radius 2.0 2.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Player.CanMove(0, 0)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Actor.SetImmunities($PLAYER_ACTOR, 1, 1, 1, 1, 1)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01F0: set_max_wanted_level_to 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0ACF: show_formatted_styled_text "HEIST" time 4000 style 2<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fade 0 1000<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0A94: start_custom_mission "HEIST"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait 1000<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end<br>&nbsp;&nbsp;&nbsp; end<br>end<br></td></tr></tbody></table>Точка старта будет в регионе кладбища самолётов.<br><br>По просьбе одного из пользователей, я добавлю scm-функции, которые будем использовать на примере этот миссии. Прежде всего, на ум попадет написать ф-ю загрузки моделей, а также установка камеры. Воспользуемся такими "прототипами":<table style="border-collapse: collapse; width: 100%; border: 1px solid black;" width=""><tbody><tr><td style="border: 1px solid black;">goto @LOAD_MODEL_END<br>:LOAD_MODEL<br>Model.Load(0@)<br>038B: load_requested_models<br>0AB2: ret 0<br>:LOAD_MODEL_END // Функция загрузки модели<br><br>goto @PASTE_CAMERA_END<br>:PASTE_CAMERA<br>04E4: refresh_game_renderer_at 0@ 1@<br>015F: set_camera_position 0@ 1@ 2@ rotation 0.0 0.0 0.0<br>0160: set_camera_point_at 3@ 4@ 5@ switchstyle 2<br>0AB2: ret 0<br>:PASTE_CAMERA_END // Функция установки камеры<br><br>goto @RESTORE_CAMERA_END<br>:RESTORE_CAMERA<br>Camera.Restore_WithJumpCut<br>Camera.SetBehindPlayer<br>0AB2: ret 0<br>:RESTORE_CAMERA_END // Функция, которая возвращает камеру в обычное положение<br></td></tr></tbody></table>В результате мы имеем 3 функции:<table style="border-collapse: collapse; width: 100%; border: 1px solid black;" width=""><tbody><tr><td style="border: 1px solid black;">0AB1: call_scm_func @LOAD_MODEL 1 #ADMIRAL<br>0AB1: call_scm_func @PASTE_CAMERA 6 position 401.501 2539.6433 16.5452 point 401.501 2539.6433 16.5452<br>0AB1: call_scm_func @RESTORE_CAMERA 0<br></td></tr></tbody></table>Давайте думать, какие ещё полезные функции можно добавить. К примеру мы можем написать функцию спавна транспорта. Она будет иметь примерно такой вид:<table style="border-collapse: collapse; width: 100%; border: 1px solid black;" width=""><tbody><tr><td style="border: 1px solid black;">goto @SPAWN_CAR_END<br>:SPAWN_CAR<br>0AB1: call_scm_func @LOAD_MODEL 1 0@<br>3@ -= 1.0<br>5@ = Car.Create(0@, 1@, 2@, 3@)<br>car.Angle(5@) = 4@<br>Model.Destroy(0@)<br>0AB2: ret 1 5@<br>:SPAWN_CAR_END<br></td></tr></tbody></table>Мы воспользовались функцией загрузки внутри функции спавна. На выходе мы получаем хендл транспорта. Сигнатура самой функции будет такой:<table style="border-collapse: collapse; width: 100%; border: 1px solid black;" width=""><tbody><tr><td style="border: 1px solid black;">0AB1: call_scm_func @SPAWN_CAR 5 model #ADMIRAL at 401.501 2539.6433 16.5452 angle 31.1548 handle_as $CAR<br></td></tr></tbody></table>Следует участь, что описание не имеет значения. Краткий пример такой функции естественно будет таким:<table style="border-collapse: collapse; width: 100%; border: 1px solid black;" width=""><tbody><tr><td style="border: 1px solid black;">0AB1: @SPAWN_CAR 5 #ADMIRAL 401.501 2539.6433 16.5452 31.1548 $CAR</td></tr></tbody></table><br>Также полезно будет написать функцию, которая будет управлять за режимы экрана(для видеоролика или обычная). Следующий код будет таким:<table style="border-collapse: collapse; width: 100%; border: 1px solid black;" width=""><tbody><tr><td style="border: 1px solid black;">goto @ENABLE_SCREEN_MODE_END<br>:ENABLE_SCREEN_MODE<br>00BE: text_clear_all<br>03E6: remove_text_box<br>if<br>0@ == 1<br>then<br>0826: enable_hud 0<br>0581: enable_radar 0<br>02A3: enable_widescreen 1<br>else<br>0826: enable_hud 1<br>0581: enable_radar 1<br>02A3: enable_widescreen 0<br>end<br>0AB2: ret 0<br>:ENABLE_SCREEN_MODE_END<br></td></tr></tbody></table>Сигнатура этого прототипа будет такой:<table style="border-collapse: collapse; width: 100%; border: 1px solid black;" width=""><tbody><tr><td style="border: 1px solid black;">0AB1: call_scm_func @ENABLE_SCREEN_MODE 1 as 1<br></td></tr></tbody></table><br>Думаю, такое количество функций будет достаточно. Начнём скриптить миссию. Начало будет, как обычно, такое:<table style="border-collapse:collapse;width:100%;"><tbody><tr><td><br><br></td></tr></tbody></table>Теперь мы увидим сцену, в которой Торино звонит CJ со своим очередным заданием:<table style="border-collapse:collapse;width:100%;"><tbody><tr><td><br></td></tr></tbody></table><br>Идёт разработка...<br><br><br><br><br><br><br><br><br><br><br><br><br><br>|19|1|0||primer_polnocennoj_missii_ograblenie|1393619746