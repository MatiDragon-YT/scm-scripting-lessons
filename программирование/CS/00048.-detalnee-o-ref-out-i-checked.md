# 00048. Детальнее о ref, out и checked

Детальнее о ref, out и checked||wmysterio|wmysterio|wmysterio@yandex.ru|||Всем огромный привет! Мы продолжаем изучать C# и сегодня мы рассмотрим интересные темы, такие как "переполнение переменных" и некоторые возможности переменных. Начнём с непонятным на первый взгляд переполнением. Каждый тип данных имеет свой диапазон значений. Основные перечислены в этом [уроке](../../publ/tipy\_dannykh\_operacii\_nad\_nimi/35-1-0-160/)(см. Диапазон значений). Если значение переменной будет вне диапазона, то это приведёт либо к ошибке приложения, либо к выводу некорректных данных. Для примера возьмём всеми любимый int:\
\
Диапазон этого типа от -2147483648 до 2147483647. Если представить переменную в виде бутылки, то это будет выглядеть так:\
![](../../\_pu/2/17171675.png)\
\
Когда мы указываем некое значение переменной, то её ёмкость увеличивается в зависимости от самого значения.\
Например выражение:\


Кодint A = 0;заполнит этот "бочонок" ровно до середины, так как он является центром диапазона:\
[![](../../\_pu/2/s25821863.jpg)](../../\_pu/2/25821863.png)\
\
При выполнении всяких операций над переменной, этот объём постоянно меняется. И существует вероятность, что переменная выйдет за пределы. Если значение слишком большое, то происходит "выливание" части значения. В шарпе обычно значение указывается на минимум, и прибавляется к нему остаток. Чтобы это продемонстрировать наглядно, напишем такой код:\
Кодusing System;\
using System.Collections.Generic;\
using System.Linq;\
using System.Text;\
\
namespace ConsoleApplication1 {\
&#x20;   class Program {\
&#x20;       static void Main( string\[] args ) {\
&#x20;           int A = 2147483647;\
&#x20;           A \*= 2;\
&#x20;           Console.WriteLine( A );\
&#x20;           Console.ReadKey();\
&#x20;       }\
&#x20;   }\
}В результате мы получаем результат -2. Каким образом получилось такое явно неправильное значение? Давайте считать! Максимальный диапазон чисел составляет 2147483647. Дальше уже считается переполнением. Делается само умножение на значение, получаем 4294967294. Так как это значение вне диапазона, то система забирает остаток от максимального значения: 4294967294 - 2147483647 = 2147483647. Далее минимальный диапазон переменной прибавляет к результату вычитания, при этом отнимает единицу от мин. значения, чтобы значение "влезало" в диапазон: ( -2147483648 - 1) + 2147483647 = -2147483649 + 2147483647 = -2. Все эти операции нужны для того, чтобы значение переменной соответствовало указанному ей типу. В противных случаях переменная будет занимать больший размер(в байтах, и даже в битах), чем требуется, что делает работу приложения нестабильным. Вот и вся арифметика.\
\
Возникает вопрос: как избежать переполнения? Самый простой вариант - указывать другой тип данных, с большим диапазоном, к примеру: long. Если такой вариант не устраивает, то можно воспользоваться конструкцией checked. Она позволяет проверить результат операции над переменной. К примеру так:\
КодA = checked( A \*= 2 );Если результат операции умножения выходит за диапазон, то возникает исключение. Этим можно восспользоваться! Заточим этот блок в try:\
Кодtry {\
&#x20;    A = checked( A \*= 2 );\
&#x20;    Console.WriteLine( A );\
} catch {\
&#x20;    Console.WriteLine( (long) A \* 2);\
}Результат:\
![](../../\_pu/2/94563876.png)\
\
Далее по плану изучим out. Он используется в функциях как выходной параметр. Сам параметр должен быть создан в коде, где вызывается функция, а описания параметра функции должно встречаться в её теле. Простой пример такой функции:\
Кодstatic void Plus( int Value, out int Result ) {\
&#x20;    Result = Value += 50;\
}А в теле мейна пишем:\
Кодstatic void Main( string\[] args ) {\
&#x20;    int k;\
&#x20;    Plus( 10, out k );\
&#x20;    Console.WriteLine( k );\
&#x20;    Console.ReadKey();\
}Результат:\
![](../../\_pu/2/26918486.png)\
\
С примера видно, что в теле основной программы мы создали переменную k. Мы не задавали ей никакого значения - за нас это сделала функция, которая реализовала это в теле. Результат записался в переменную k, как выходной параметр.\
\
На очереди у нас ещё одна интересная фича - передача ссылок на переменные. Когда мы передаём в функцию какое-то значение, то в функцию кидается её копия. К примеру возьмём такую функцию:\
Кодusing System;\
using System.Collections.Generic;\
using System.Linq;\
using System.Text;\
\
namespace ConsoleApplication1 {\
&#x20;   class Program {\
&#x20;       static void Main( string\[] args ) {\
&#x20;           int A = 10;\
&#x20;           Plus( A );\
&#x20;           Console.ReadKey();\
&#x20;       }\
\
&#x20;       static void Plus( int A ) {\
&#x20;           A += 50;\
&#x20;           Console.WriteLine( "Функция: значение А = {0}", A);\
&#x20;       }\
&#x20;   }\
}Результат такой операции:\
![](../../\_pu/2/67794547.png)\
Давайте проверим, чему равно значение A:\
Кодusing System;\
using System.Collections.Generic;\
using System.Linq;\
using System.Text;\
\
namespace ConsoleApplication1 {\
&#x20;   class Program {\
&#x20;       static void Main( string\[] args ) {\
&#x20;           int A = 10;\
&#x20;           Plus( A );\
&#x20;           Console.WriteLine( "Мейн: значение А = {0}", A );\
&#x20;           Console.ReadKey();\
&#x20;       }\
\
&#x20;       static void Plus( int A ) {\
&#x20;           A += 50;\
&#x20;           Console.WriteLine( "Функция: значение А = {0}", A);\
&#x20;       }\
&#x20;   }\
}Проверяем нашу программу:\
![](../../\_pu/2/07989036.png)\
\
Как видим, в функцию передалась копия переменной, но есть одна фича, которая позволяет передавать переменную напрямую, используя ссылки, в c# известны как ref. Добавим эту сточку в параметр функции, а также объявим при вызове функции:\
Кодusing System;\
using System.Collections.Generic;\
using System.Linq;\
using System.Text;\
\
namespace ConsoleApplication1 {\
&#x20;   class Program {\
&#x20;       static void Main( string\[] args ) {\
&#x20;           int A = 10;\
&#x20;           Plus( ref A );\
&#x20;           Console.WriteLine( "Мейн: значение А = {0}", A );\
&#x20;           Console.ReadKey();\
&#x20;       }\
\
&#x20;       static void Plus( ref int A ) {\
&#x20;           A += 50;\
&#x20;           Console.WriteLine( "Функция: значение А = {0}", A);\
&#x20;       }\
&#x20;   }\
}Результат:\
![](../../\_pu/2/70049643.png)\
\
Таким образом мы можем динамически изменять значение переменных. Это также увеличивает скорость работы программы, так как она не создаёт копию параметров.\
\
Надеюсь, этот урок был полезен для Вас. Это был мистерио, пока.\
|771|1|0|25821863`png`672`478`400`284\|17171675`png`380`334|94563876`png`166`95\|26918486`png`159`82|67794547`png`253`98\|07989036`png`241`104|70049643`png`250\`92||detalnee\_o\_ref\_out\_i\_checked|1399127593
